<mxfile host="app.diagrams.net" modified="2024-01-01T00:00:00.000Z" agent="Mozilla/5.0" version="22.1.0" type="device">
  <diagram name="Log Analytics KQL Architecture" id="log-analytics-kql-arch">
    <mxGraphModel dx="1400" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="900" math="0" shadow="1">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="Log Analytics &amp; KQL Query Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1;fontColor=#0078D4;" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="700" height="40" as="geometry" />
        </mxCell>

        <!-- Log Analytics Workspace -->
        <mxCell id="la-workspace" value="Log Analytics Workspace" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E6F2FF;strokeColor=#0078D4;strokeWidth=2;shadow=1;verticalAlign=top;fontStyle=1;fontSize=16;spacingTop=10;" vertex="1" parent="1">
          <mxGeometry x="80" y="80" width="560" height="280" as="geometry" />
        </mxCell>

        <!-- Log Tables -->
        <mxCell id="tables-group" value="Log Tables" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;shadow=1;verticalAlign=top;fontStyle=1;fontSize=12;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="100" y="120" width="200" height="220" as="geometry" />
        </mxCell>

        <mxCell id="table-signin" value="SigninLogs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;shadow=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="120" y="155" width="160" height="30" as="geometry" />
        </mxCell>

        <mxCell id="table-audit" value="AuditLogs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;shadow=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="120" y="195" width="160" height="30" as="geometry" />
        </mxCell>

        <mxCell id="table-noninter" value="NonInteractiveSignInLogs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;shadow=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="120" y="235" width="160" height="30" as="geometry" />
        </mxCell>

        <mxCell id="table-sp" value="ServicePrincipalSignInLogs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;shadow=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="120" y="275" width="160" height="30" as="geometry" />
        </mxCell>

        <mxCell id="table-risk" value="UserRiskEvents" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;strokeWidth=2;shadow=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="120" y="315" width="160" height="30" as="geometry" />
        </mxCell>

        <!-- KQL Query Engine -->
        <mxCell id="kql-engine" value="KQL Query Engine" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;shadow=1;verticalAlign=top;fontStyle=1;fontSize=12;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="320" y="120" width="300" height="220" as="geometry" />
        </mxCell>

        <mxCell id="kql-where" value="where" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;shadow=1;fontSize=10;fontFamily=Consolas;" vertex="1" parent="1">
          <mxGeometry x="340" y="155" width="60" height="25" as="geometry" />
        </mxCell>

        <mxCell id="kql-project" value="project" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;shadow=1;fontSize=10;fontFamily=Consolas;" vertex="1" parent="1">
          <mxGeometry x="410" y="155" width="60" height="25" as="geometry" />
        </mxCell>

        <mxCell id="kql-extend" value="extend" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;shadow=1;fontSize=10;fontFamily=Consolas;" vertex="1" parent="1">
          <mxGeometry x="480" y="155" width="60" height="25" as="geometry" />
        </mxCell>

        <mxCell id="kql-summarize" value="summarize" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;shadow=1;fontSize=10;fontFamily=Consolas;" vertex="1" parent="1">
          <mxGeometry x="550" y="155" width="60" height="25" as="geometry" />
        </mxCell>

        <mxCell id="kql-join" value="join" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;shadow=1;fontSize=10;fontFamily=Consolas;" vertex="1" parent="1">
          <mxGeometry x="340" y="190" width="60" height="25" as="geometry" />
        </mxCell>

        <mxCell id="kql-mvexpand" value="mv-expand" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;shadow=1;fontSize=10;fontFamily=Consolas;" vertex="1" parent="1">
          <mxGeometry x="410" y="190" width="60" height="25" as="geometry" />
        </mxCell>

        <mxCell id="kql-order" value="order by" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;shadow=1;fontSize=10;fontFamily=Consolas;" vertex="1" parent="1">
          <mxGeometry x="480" y="190" width="60" height="25" as="geometry" />
        </mxCell>

        <mxCell id="kql-render" value="render" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;shadow=1;fontSize=10;fontFamily=Consolas;" vertex="1" parent="1">
          <mxGeometry x="550" y="190" width="60" height="25" as="geometry" />
        </mxCell>

        <!-- Query Example Box -->
        <mxCell id="query-example" value="SigninLogs&#xa;| where TimeGenerated &gt; ago(24h)&#xa;| where ResultType != 0&#xa;| summarize count() by User&#xa;| order by count_ desc" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;shadow=1;fontSize=9;fontFamily=Consolas;align=left;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="340" y="235" width="260" height="90" as="geometry" />
        </mxCell>

        <!-- Query Outputs -->
        <mxCell id="outputs-group" value="Query Outputs" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;strokeWidth=2;shadow=1;verticalAlign=top;fontStyle=1;fontSize=14;spacingTop=8;" vertex="1" parent="1">
          <mxGeometry x="700" y="80" width="280" height="280" as="geometry" />
        </mxCell>

        <mxCell id="output-table" value="Results Table" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;strokeWidth=2;shadow=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="720" y="130" width="110" height="35" as="geometry" />
        </mxCell>

        <mxCell id="output-chart" value="Charts &amp; Graphs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;strokeWidth=2;shadow=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="850" y="130" width="110" height="35" as="geometry" />
        </mxCell>

        <mxCell id="output-timechart" value="Time Charts" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;strokeWidth=2;shadow=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="720" y="175" width="110" height="35" as="geometry" />
        </mxCell>

        <mxCell id="output-pie" value="Pie Charts" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;strokeWidth=2;shadow=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="850" y="175" width="110" height="35" as="geometry" />
        </mxCell>

        <mxCell id="output-export" value="CSV Export" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;strokeWidth=2;shadow=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="720" y="220" width="110" height="35" as="geometry" />
        </mxCell>

        <mxCell id="output-powerbi" value="Power BI" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;strokeWidth=2;shadow=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="850" y="220" width="110" height="35" as="geometry" />
        </mxCell>

        <!-- Arrow from tables to KQL -->
        <mxCell id="arrow-tables-kql" style="curved=1;endArrow=blockThin;endFill=1;strokeColor=#6c8ebf;strokeWidth=3;exitX=1;exitY=0.5;entryX=0;entryY=0.5;shadow=0;" edge="1" parent="1" source="tables-group" target="kql-engine">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Arrow from KQL to Outputs -->
        <mxCell id="arrow-kql-outputs" style="curved=1;endArrow=blockThin;endFill=1;strokeColor=#82b366;strokeWidth=3;exitX=1;exitY=0.5;entryX=0;entryY=0.5;shadow=0;" edge="1" parent="1" source="kql-engine" target="outputs-group">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Downstream Integrations -->
        <mxCell id="integrations-title" value="Downstream Integrations" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="350" y="400" width="200" height="30" as="geometry" />
        </mxCell>

        <!-- Alerts -->
        <mxCell id="alerts-box" value="Alert Rules" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;strokeWidth=2;shadow=1;verticalAlign=top;fontStyle=1;fontSize=11;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="80" y="440" width="160" height="100" as="geometry" />
        </mxCell>

        <mxCell id="alert-email" value="Email Notifications" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;strokeWidth=2;shadow=1;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="95" y="475" width="130" height="25" as="geometry" />
        </mxCell>

        <mxCell id="alert-action" value="Logic App / Runbook" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;strokeWidth=2;shadow=1;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="95" y="505" width="130" height="25" as="geometry" />
        </mxCell>

        <!-- Workbooks -->
        <mxCell id="workbooks-box" value="Workbooks" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;shadow=1;verticalAlign=top;fontStyle=1;fontSize=11;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="280" y="440" width="160" height="100" as="geometry" />
        </mxCell>

        <mxCell id="wb-interactive" value="Interactive Reports" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;shadow=1;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="295" y="475" width="130" height="25" as="geometry" />
        </mxCell>

        <mxCell id="wb-params" value="Parameterized Views" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;shadow=1;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="295" y="505" width="130" height="25" as="geometry" />
        </mxCell>

        <!-- Dashboards -->
        <mxCell id="dash-box" value="Azure Dashboards" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;shadow=1;verticalAlign=top;fontStyle=1;fontSize=11;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="480" y="440" width="160" height="100" as="geometry" />
        </mxCell>

        <mxCell id="dash-pin" value="Pinned Queries" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;shadow=1;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="495" y="475" width="130" height="25" as="geometry" />
        </mxCell>

        <mxCell id="dash-share" value="Shared Dashboards" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;shadow=1;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="495" y="505" width="130" height="25" as="geometry" />
        </mxCell>

        <!-- Sentinel -->
        <mxCell id="sentinel-box" value="Microsoft Sentinel" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;shadow=1;verticalAlign=top;fontStyle=1;fontSize=11;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="680" y="440" width="160" height="100" as="geometry" />
        </mxCell>

        <mxCell id="sentinel-hunting" value="Threat Hunting" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;shadow=1;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="695" y="475" width="130" height="25" as="geometry" />
        </mxCell>

        <mxCell id="sentinel-analytics" value="Analytics Rules" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;shadow=1;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="695" y="505" width="130" height="25" as="geometry" />
        </mxCell>

        <!-- Arrows to integrations -->
        <mxCell id="arrow-to-alerts" style="curved=1;endArrow=blockThin;endFill=1;strokeColor=#b85450;strokeWidth=2;exitX=0.25;exitY=1;entryX=0.5;entryY=0;shadow=0;" edge="1" parent="1" source="outputs-group" target="alerts-box">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="450" y="400" />
              <mxPoint x="160" y="420" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow-to-workbooks" style="curved=1;endArrow=blockThin;endFill=1;strokeColor=#d6b656;strokeWidth=2;exitX=0.4;exitY=1;entryX=0.5;entryY=0;shadow=0;" edge="1" parent="1" source="outputs-group" target="workbooks-box">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="550" y="390" />
              <mxPoint x="360" y="420" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow-to-dash" style="curved=1;endArrow=blockThin;endFill=1;strokeColor=#82b366;strokeWidth=2;exitX=0.6;exitY=1;entryX=0.5;entryY=0;shadow=0;" edge="1" parent="1" source="outputs-group" target="dash-box">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="700" y="390" />
              <mxPoint x="560" y="420" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow-to-sentinel" style="curved=1;endArrow=blockThin;endFill=1;strokeColor=#6c8ebf;strokeWidth=2;exitX=0.75;exitY=1;entryX=0.5;entryY=0;shadow=0;" edge="1" parent="1" source="outputs-group" target="sentinel-box">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="800" y="400" />
              <mxPoint x="760" y="420" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Query Categories Legend -->
        <mxCell id="legend-box" value="Common Query Categories" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;strokeWidth=2;shadow=1;verticalAlign=top;fontStyle=1;fontSize=11;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="1020" y="80" width="180" height="200" as="geometry" />
        </mxCell>

        <mxCell id="cat-signin" value="Sign-in Analysis" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;shadow=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1040" y="115" width="140" height="25" as="geometry" />
        </mxCell>

        <mxCell id="cat-audit" value="Audit Trail Review" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;shadow=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1040" y="150" width="140" height="25" as="geometry" />
        </mxCell>

        <mxCell id="cat-security" value="Security Investigation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;strokeWidth=2;shadow=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1040" y="185" width="140" height="25" as="geometry" />
        </mxCell>

        <mxCell id="cat-compliance" value="Compliance Reporting" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;shadow=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1040" y="220" width="140" height="25" as="geometry" />
        </mxCell>

        <mxCell id="cat-trending" value="Trend Analysis" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;strokeWidth=2;shadow=1;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1040" y="255" width="140" height="25" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
