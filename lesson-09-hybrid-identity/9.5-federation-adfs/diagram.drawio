<mxfile host="app.diagrams.net" modified="2024-01-01T00:00:00.000Z" agent="Mozilla/5.0" version="22.1.0" type="device">
  <diagram name="Federation with AD FS" id="adfs-diagram">
    <mxGraphModel dx="1400" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="900" math="0" shadow="1">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="Federation with AD FS Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1;fontColor=#0078D4;" vertex="1" parent="1">
          <mxGeometry x="350" y="15" width="700" height="35" as="geometry" />
        </mxCell>

        <!-- Internet Zone -->
        <mxCell id="internet-zone" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;strokeWidth=2;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="60" width="250" height="240" as="geometry" />
        </mxCell>
        <mxCell id="internet-header" value="Internet / Cloud" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#666666;strokeColor=#666666;fontColor=#ffffff;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="60" width="250" height="25" as="geometry" />
        </mxCell>

        <!-- User -->
        <mxCell id="user" value="External User" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;fontStyle=1;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="100" width="90" height="50" as="geometry" />
        </mxCell>

        <!-- Entra ID -->
        <mxCell id="entra" value="Microsoft&#xa;Entra ID" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;fontStyle=1;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="80" y="170" width="90" height="60" as="geometry" />
        </mxCell>

        <!-- M365 -->
        <mxCell id="m365" value="Microsoft 365&#xa;Apps" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="190" y="135" width="90" height="60" as="geometry" />
        </mxCell>

        <!-- DMZ Zone -->
        <mxCell id="dmz-zone" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;strokeWidth=2;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="350" y="60" width="200" height="240" as="geometry" />
        </mxCell>
        <mxCell id="dmz-header" value="DMZ / Perimeter" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d79b00;strokeColor=#d79b00;fontColor=#ffffff;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="350" y="60" width="200" height="25" as="geometry" />
        </mxCell>

        <!-- WAP Servers -->
        <mxCell id="wap-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#d79b00;strokeWidth=1;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="370" y="100" width="160" height="180" as="geometry" />
        </mxCell>
        <mxCell id="wap-label" value="WAP Farm" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontSize=10;fontStyle=1;fontColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="370" y="105" width="160" height="15" as="geometry" />
        </mxCell>

        <mxCell id="wap1" value="WAP01" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="390" y="130" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="wap2" value="WAP02" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="460" y="130" width="60" height="40" as="geometry" />
        </mxCell>

        <mxCell id="wap-lb" value="Load Balancer&#xa;sts.contoso.com" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="390" y="185" width="130" height="40" as="geometry" />
        </mxCell>

        <mxCell id="wap-cert" value="SSL Cert" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="400" y="235" width="110" height="30" as="geometry" />
        </mxCell>

        <!-- Internal Zone -->
        <mxCell id="internal-zone" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="600" y="60" width="350" height="240" as="geometry" />
        </mxCell>
        <mxCell id="internal-header" value="Internal Network" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#6c8ebf;strokeColor=#6c8ebf;fontColor=#ffffff;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="600" y="60" width="350" height="25" as="geometry" />
        </mxCell>

        <!-- AD FS Servers -->
        <mxCell id="adfs-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#6c8ebf;strokeWidth=1;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="620" y="100" width="160" height="180" as="geometry" />
        </mxCell>
        <mxCell id="adfs-label" value="AD FS Farm" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontSize=10;fontStyle=1;fontColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="620" y="105" width="160" height="15" as="geometry" />
        </mxCell>

        <mxCell id="adfs1" value="ADFS01&#xa;(Primary)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="640" y="130" width="60" height="45" as="geometry" />
        </mxCell>
        <mxCell id="adfs2" value="ADFS02" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="710" y="130" width="60" height="45" as="geometry" />
        </mxCell>

        <mxCell id="adfs-lb" value="Internal LB&#xa;sts.contoso.com" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=9;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="640" y="185" width="130" height="40" as="geometry" />
        </mxCell>

        <mxCell id="token-cert" value="Token Signing&#xa;Certificate" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=9;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="640" y="235" width="130" height="30" as="geometry" />
        </mxCell>

        <!-- Active Directory -->
        <mxCell id="ad-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#6c8ebf;strokeWidth=1;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="800" y="100" width="130" height="130" as="geometry" />
        </mxCell>
        <mxCell id="ad-label" value="Active Directory" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontSize=10;fontStyle=1;fontColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="800" y="105" width="130" height="15" as="geometry" />
        </mxCell>

        <mxCell id="dc1" value="DC01" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="820" y="130" width="45" height="35" as="geometry" />
        </mxCell>
        <mxCell id="dc2" value="DC02" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="870" y="130" width="45" height="35" as="geometry" />
        </mxCell>

        <mxCell id="sql" value="SQL Server&#xa;(Config DB)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=9;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="815" y="180" width="100" height="40" as="geometry" />
        </mxCell>

        <!-- Firewalls -->
        <mxCell id="fw1" value="FW" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;fontStyle=1;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="310" y="160" width="30" height="30" as="geometry" />
        </mxCell>
        <mxCell id="fw2" value="FW" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10;fontStyle=1;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="560" y="160" width="30" height="30" as="geometry" />
        </mxCell>

        <!-- Authentication Flow Section -->
        <mxCell id="flow-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="330" width="900" height="160" as="geometry" />
        </mxCell>
        <mxCell id="flow-header" value="Federation Authentication Flow" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#82b366;strokeColor=#82b366;fontColor=#ffffff;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="330" width="900" height="30" as="geometry" />
        </mxCell>

        <!-- Flow Steps -->
        <mxCell id="step1" value="1. User accesses&#xa;M365 App" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="70" y="380" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="step2" value="2. Redirect to&#xa;Entra ID" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="190" y="380" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="step3" value="3. Redirect to&#xa;AD FS (WAP)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="310" y="380" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="step4" value="4. AD FS&#xa;Authenticates" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="430" y="380" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="step5" value="5. SAML Token&#xa;Issued" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="550" y="380" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="step6" value="6. Token to&#xa;Entra ID" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="670" y="380" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="step7" value="7. Access&#xa;Granted" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#006400;fontSize=10;fontStyle=1;shadow=1;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="790" y="380" width="100" height="50" as="geometry" />
        </mxCell>

        <!-- Flow Arrows -->
        <mxCell id="f-arrow1" style="curved=1;endArrow=blockThin;endFill=1;strokeColor=#0078D4;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="175" y="405" as="sourcePoint" />
            <mxPoint x="185" y="405" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="f-arrow2" style="curved=1;endArrow=blockThin;endFill=1;strokeColor=#0078D4;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="295" y="405" as="sourcePoint" />
            <mxPoint x="305" y="405" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="f-arrow3" style="curved=1;endArrow=blockThin;endFill=1;strokeColor=#0078D4;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="415" y="405" as="sourcePoint" />
            <mxPoint x="425" y="405" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="f-arrow4" style="curved=1;endArrow=blockThin;endFill=1;strokeColor=#0078D4;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="535" y="405" as="sourcePoint" />
            <mxPoint x="545" y="405" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="f-arrow5" style="curved=1;endArrow=blockThin;endFill=1;strokeColor=#0078D4;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="655" y="405" as="sourcePoint" />
            <mxPoint x="665" y="405" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="f-arrow6" style="curved=1;endArrow=blockThin;endFill=1;strokeColor=#82b366;strokeWidth=2;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="775" y="405" as="sourcePoint" />
            <mxPoint x="785" y="405" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- When to Use Section -->
        <mxCell id="when-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;strokeWidth=2;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="520" width="420" height="170" as="geometry" />
        </mxCell>
        <mxCell id="when-header" value="When to Use AD FS" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#9673a6;strokeColor=#9673a6;fontColor=#ffffff;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="50" y="520" width="420" height="30" as="geometry" />
        </mxCell>

        <mxCell id="use1" value="Smart card / certificate auth" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#9673a6;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="70" y="565" width="180" height="30" as="geometry" />
        </mxCell>
        <mxCell id="use2" value="Third-party MFA integration" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#9673a6;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="270" y="565" width="180" height="30" as="geometry" />
        </mxCell>
        <mxCell id="use3" value="Complex claims requirements" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#9673a6;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="70" y="605" width="180" height="30" as="geometry" />
        </mxCell>
        <mxCell id="use4" value="On-prem auth mandate" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#9673a6;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="270" y="605" width="180" height="30" as="geometry" />
        </mxCell>
        <mxCell id="use5" value="Legacy SAML 1.1 / WS-Fed apps" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#9673a6;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="170" y="645" width="180" height="30" as="geometry" />
        </mxCell>

        <!-- Components Section -->
        <mxCell id="comp-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="490" y="520" width="460" height="170" as="geometry" />
        </mxCell>
        <mxCell id="comp-header" value="AD FS Components" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d6b656;strokeColor=#d6b656;fontColor=#ffffff;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="490" y="520" width="460" height="30" as="geometry" />
        </mxCell>

        <mxCell id="comp1" value="AD FS Servers&#xa;Token issuance" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="510" y="565" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="comp2" value="WAP Servers&#xa;External proxy" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="625" y="565" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="comp3" value="SQL Database&#xa;Configuration" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="740" y="565" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="comp4" value="Certificates&#xa;Signing + SSL" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;shadow=1;" vertex="1" parent="1">
          <mxGeometry x="855" y="565" width="80" height="50" as="geometry" />
        </mxCell>

        <mxCell id="ha-note" value="Deploy 2+ of each for High Availability | Use load balancers | Enable PHS as backup" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontSize=10;fontColor=#d6b656;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="510" y="640" width="420" height="30" as="geometry" />
        </mxCell>

        <!-- Architecture Connection Arrows -->
        <mxCell id="arch-arrow1" style="curved=1;endArrow=blockThin;endFill=1;strokeColor=#0078D4;strokeWidth=2;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" parent="1" source="entra" target="fw1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="240" y="175" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="arch-arrow2" style="curved=1;endArrow=blockThin;endFill=1;strokeColor=#d79b00;strokeWidth=2;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" parent="1" source="wap-lb" target="fw2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="540" y="175" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="arch-arrow3" style="curved=1;endArrow=blockThin;endFill=1;strokeColor=#6c8ebf;strokeWidth=2;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" parent="1" source="adfs-lb" target="ad-box">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="790" y="175" />
            </Array>
          </mxGeometry>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
